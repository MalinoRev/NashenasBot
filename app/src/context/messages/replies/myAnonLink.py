import os

def get_message(referral_id: str | None, display_name: str | None) -> str:
	if not referral_id:
		return "Ù„ÛŒÙ†Ú© Ù†Ø§Ø´Ù†Ø§Ø³ Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ú©Ù…ÛŒ Ø¨Ø¹Ø¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯."

	# Prefer DB settings; fallback to env
	try:
		import asyncio
		from src.services.bot_settings_service import get_bot_settings
		settings = asyncio.get_event_loop().run_until_complete(get_bot_settings())  # type: ignore[arg-type]
		bot_username = getattr(settings, "bot_channel", None)
	except Exception:
		bot_username = None
	if not bot_username:
		bot_username = os.getenv("TELEGRAM_BOT_USERNAME")
	if not bot_username:
		return "Ø®Ø·Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ù…Ø¯ÛŒØ± ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯."

	name = display_name or "Ø¯ÙˆØ³Øª"
	telegram_link = f"https://telegram.me/{bot_username}?start=inv_{referral_id}"

	return (
		f"Ø³Ù„Ø§Ù… {name} Ù‡Ø³ØªÙ… âœ‹\n\n"
		"Ù„ÛŒÙ†Ú© Ø²ÛŒØ± Ø±Ùˆ Ù„Ù…Ø³ Ú©Ù† Ùˆ Ù‡Ø± Ø­Ø±ÙÛŒ Ú©Ù‡ ØªÙˆ Ø¯Ù„Øª Ù‡Ø³Øª ÛŒØ§ Ù‡Ø± Ø§Ù†ØªÙ‚Ø§Ø¯ÛŒ Ú©Ù‡ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù…Ù† Ø¯Ø§Ø±ÛŒ Ø±Ùˆ Ø¨Ø§ Ø®ÛŒØ§Ù„ Ø±Ø§Ø­Øª Ø¨Ù†ÙˆÛŒØ³ Ùˆ Ø¨ÙØ±Ø³Øª. Ø¨Ø¯ÙˆÙ† Ø§ÛŒÙ†Ú©Ù‡ Ø§Ø² Ø§Ø³Ù…Øª Ø¨Ø§Ø®Ø¨Ø± Ø¨Ø´Ù… Ù¾ÛŒØ§Ù…Øª Ø¨Ù‡ Ù…Ù† Ù…ÛŒâ€ŒØ±Ø³Ù‡. Ø®ÙˆØ¯ØªÙ… Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒ Ùˆ Ø§Ø² Ø¨Ù‚ÛŒÙ‡ Ø¨Ø®ÙˆØ§ÛŒ Ø±Ø§Ø­Øª Ùˆ Ù†Ø§Ø´Ù†Ø§Ø³ Ø¨Ù‡Øª Ù¾ÛŒØ§Ù… Ø¨ÙØ±Ø³ØªÙ†ØŒ Ø­Ø±ÙØ§ÛŒ Ø®ÛŒÙ„ÛŒ Ø¬Ø§Ù„Ø¨ÛŒ Ù…ÛŒâ€ŒØ´Ù†ÙˆÛŒ! ğŸ˜‰\n\n"
		"ğŸ‘‡ğŸ‘‡\n"
		f"{telegram_link}"
	)


